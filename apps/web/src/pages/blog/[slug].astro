---
import { getCollection } from "astro:content";
import { YOUTUBE_VIDEO_ID } from "@marble/utils";
import Container from "@/components/Container.astro";
import Prose from "@/components/Prose.astro";
import Button from "@/components/ui/Button.astro";
import Layout from "@/layouts/Layout.astro";
import { SITE } from "@/lib/constants/site";
import { calculateReadTime } from "@/lib/utils";

const YOUTUBE_WATCH_URL = `https://www.youtube.com/watch?v=${YOUTUBE_VIDEO_ID}`;

export const prerender = true;

export async function getStaticPaths() {
  const blogEntries = await getCollection("posts");
  return blogEntries.map((entry) => ({
    params: { slug: entry.data.slug },
    props: { entry },
  }));
}

const { entry } = Astro.props;

const formattedDate = new Date(entry.data.publishedAt).toLocaleDateString(
  "en-US",
  {
    year: "numeric",
    month: "long",
    day: "numeric",
  }
);

const readTime = calculateReadTime(entry.data.content);
---

<Layout
  title={`${entry.data.title} - ${SITE.TITLE}`}
  description={entry.data.description}
  image={entry.data.coverImage}
>
  <section
    class="min-h-[calc(100vh-88px)] sm:min-h-[calc(100vh-103px)] lg:min-h-[calc(100vh-120px)] border-t border-dashed"
  >
    <div
      class="lg:border-x border-dashed md:w-[calc(100%-140px)] mx-auto h-full"
    >
      <Container class="md:py-20 py-10 md:pb-24">
        <section class="max-w-3xl mx-auto mb-6 md:mb-10 space-y-6">
          <div class="flex flex-col gap-4 max-w-2xl mx-auto">
            <h1 class="text-3xl lg:text-4xl text-balance leading-[1.2] mb-2">
              {entry.data.title}
            </h1>
            <div class="flex items-center gap-6 justify-btween">
              <div class="flex items-center gap-2">
                <span class="h-4 w-0.5 bg-gray-300 shrink-0"></span>
                <time
                  datetime={entry.data.publishedAt.toISOString()}
                  class="text-muted-foreground text-sm sm:text-base"
                >
                  {formattedDate}
                </time>
              </div>
              <div class="flex items-center gap-2">
                <span class="h-4 w-0.5 bg-gray-300 shrink-0"></span>
                <p class="text-muted-foreground text-sm sm:text-base">
                  {readTime}minute read
                </p>
              </div>
            </div>
            <!-- <div class="flex items-center gap-2">
              {entry.data.authors[0].image ? (
                <Image src={entry.data.authors[0].image} alt={entry.data.authors[0].name} class="size-7 rounded-full" inferSize />
              ) : (
                <span class="h-4 w-0.5 bg-gray-300 shrink-0"></span>
              )}
              <p class="text-muted-foreground text-sm sm:text-base">{entry.data.authors[0].name}</p>
            </div> -->
          </div>
        </section>
        <!-- <div>
          {entry.data.coverImage && (
            <Image src={entry.data.coverImage} alt={entry.data.title} class="w-full max-w-3xl mx-auto mb-8" inferSize />
          )}
        </div> -->
        <Prose>
          <div set:html={entry.data.content} />
        </Prose>
      </Container>
    </div>
  </section>
  <section class="border-y border-dashed">
    <div class="lg:border-x border-dashed md:w-[calc(100%-140px)] mx-auto">
      <Container class="py-12 md:py-20">
        <div class="flex flex-col items-center space-y-6">
          <div class="space-y-4 text-center">
            <h2
              class="relative text-center text-balance text-2xl tracking-tight md:text-3xl lg:text-4xl max-w-4xl"
            >
              Try Marble today.
            </h2>
            <p
              class="mx-auto max-w-2xl text-muted-foreground md:text-lg text-balance"
            >
              A simpler way to publish articles and manage your blog.
            </p>
          </div>

          <div
            class="flex flex-col sm:flex-row w-full items-center justify-center gap-4"
          >
            <Button
              href={SITE.APP_URL}
              target="_blank"
              class="w-full sm:w-auto"
            >
              Try Marble for free
            </Button>
            <Button
              href={YOUTUBE_WATCH_URL}
              variant="secondary"
              class="w-full sm:w-auto"
            >
              Watch Demo
            </Button>
          </div>
        </div>
      </Container>
    </div>
  </section>
</Layout>
